(function(b){b.fn.NetopesTreeComboBox=function(h){function q(a){b(a).siblings('input[type="text"]').on("click",function(){k(a)});b(a).siblings("div.ctrl-dd-i-btn").on("click",function(){k(a)});b(a).siblings("div.ctrl-clear").on("click",function(){l(a,!0)});c.disabled&&(b(a).prop("disabled","disabled"),b(a).removeClass("stdro"),b(a).siblings("div.ctrl-dropdown").hide());if("string"===typeof c.onChange&&0<c.onChange.length)b(a).on("change",function(){try{eval(c.onChange)}catch(d){console.log(d),console.log(c.onChange)}});
a.ajaxUrl=c.ajaxUrl;a.ajaxUrlParams="&module="+c.module+"&method="+c.method;c.hideParentsCheckbox&&(a.ajaxUrlParams+="&hpc=1");c.urlParams&&(a.ajaxUrlParams+=c.urlParams);a.urlCallback=function(){var d="";if("object"===typeof c.jsParams)for(var e in c.jsParams){var g=void 0;try{g=eval(c.jsParams[e])}catch(f){console.log(f),console.log(c.jsParams[e]),g=""}d+="&"+e+"="+g}else"string"===typeof c.jsParams&&(d=c.jsParams);this.ajaxUrl=1===c.encrypt||!0===c.encrypt?this.ajaxUrl+("&arhash="+encodeURIComponent(GibberishAES.enc(a.ajaxUrlParams+
d+"&phash="+window.name,"xJS"))):this.ajaxUrl+(a.ajaxUrlParams+d+"&phash="+window.name);return this.ajaxUrl+"&response_type=json&tree=1&val="+encodeURIComponent(b(a).val())};b("#"+a.id+"-ctree").fancytree({checkbox:!0,icon:c.useIcons||!1,selectMode:1,clickFolderMode:1,debugLevel:0,source:function(){return{url:a.urlCallback(),cache:!1}},lazyLoad:function(b,e){b=a.urlCallback();e.result={url:b,data:{key:e.node.key}}},createNode:function(d,e){if(!e.node.data.hasSelectedChild)return!1;d=a.urlCallback();
b.ajax({url:d,data:{key:e.node.key},dataType:"json",success:function(a){e.node.addChildren(a)}})},select:function(b,e){e.node.isSelected()?(m(a,e.node.key,e.node.title,!1,!1),k(a)):m(a,"","",!1,!1)}})}var c={value:"",ajaxUrl:"",module:"",method:"",urlParams:"",jsParams:{},encrypt:!1,hideParentsCheckbox:!1,useIcons:!1,onChange:!1,disabled:!1};"object"===typeof h&&b.extend(c,h);var l=function(a,d){d&&b(a).prop("disabled")||(d=b(a).val(),b(a).val(""),b(a).siblings('input[type="text"]').val(""),a=b("#"+
a.id+"-ctree").fancytree("getTree").getNodeByKey(d),null!=a&&a.setSelected(!1))},m=function(a,d,e,c,f){var g=b(a).val();b(a).val(d);b(a).siblings('input[type="text"]').val(e);if(b(a).prop("disabled"))return!1;d=b(a).attr("id");if(!0===f||1===f||"1"===f)b("#"+d+"-ctree").fancytree("getTree").reload();else if(!0===c||1===c||"1"===c)c=b("#"+d+"-ctree").fancytree("getTree").getNodeByKey(g),null!=c&&c.setSelected(!1);b(a).trigger("change")},k=function(a){if(!b(a).prop("disabled")){var d=b(a).siblings("div.ctrl-dropdown"),
c=b(a).siblings('input[type="text"]');if("none"===b(d).css("display")){a=b(d).width();var g=b(c).outerWidth(),f=b(c).position();c=f.top+b(c).outerHeight();f=f.left;f+a>window.innerWidth&&window.innerWidth>a&&(f=Math.max(0,f-(a-g)));b(d).css("top",c+"px");b(d).css("left",f+"px");b(d).show()}else b(d).hide()}},n={disabled:function(a,c,e){!0===c||1===c||"1"===c?(b(a).prop("disabled","disabled"),b(a).siblings("div.ctrl-dropdown").hide(),b(a).siblings('input[type="text"]').removeClass("stdro")):(b(a).prop("disabled",
!1),b(a).siblings('input[type="text"]').addClass("stdro"));!0!==e&&1!==e&&"1"!==e||l(a,!1);return!0},clear:function(a){l(a,!1)},setValue:function(a,b,c,g,f){m(a,b,c,g,f)}};if("string"===typeof h){if(n[h]){var p=Array.prototype.slice.call(arguments,1);p.unshift(this);return n[h].apply(this,p)}console.log("Invalid or inaccessible method: ["+h+"]!")}else return this.each(function(){q(this)})}})(jQuery);
