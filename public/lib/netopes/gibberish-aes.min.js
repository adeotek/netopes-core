/*
 Gibberish-AES
 A lightweight Javascript Libray for OpenSSL compatible AES CBC encryption.

 Author: Mark Percival
 Email: mark@mpercival.com
 Copyright: Mark Percival - http://mpercival.com 2008

 With thanks to:
 Josh Davis - http://www.josh-davis.org/ecmaScrypt
 Chris Veness - http://www.movable-type.co.uk/scripts/aes.html
 Michel I. Gallant - http://www.jensign.com/
 Jean-Luc Cooke <jlcooke@certainkey.com> 2012-07-12: added strhex + invertArr to compress G2X/G3X/G9X/GBX/GEX/SBox/SBoxInv/Rcon saving over 7KB, and added encString, decString, also made the MD5 routine more easlier compressible using yuicompressor.

 License: MIT

 Usage: GibberishAES.enc("secret", "password")
 Outputs: AES Encrypted text encoded in Base64
*/
(function(r,q){"object"===typeof exports?module.exports=q():"function"===typeof define&&define.amd?define(q):r.GibberishAES=q()})(this,function(){var r=14,q=8,t=!1,K=function(a,d){var b="",c;if(d){d=a[15];if(16<d)throw"Decryption error: Maybe bad key";if(16===d)return"";for(c=0;c<16-d;c++)b+=String.fromCharCode(a[c])}else for(c=0;16>c;c++)b+=String.fromCharCode(a[c]);return b},v=function(a,d){var b=[];if(!d)try{a=unescape(encodeURIComponent(a))}catch(c){throw"Error on UTF-8 encode";}for(d=0;d<a.length;d++)b[d]=
a.charCodeAt(d);return b},F=function(a,d){var b=12<=r?3:2;var c=[];d=a.concat(d);var n;c[0]=E(d);a=c[0];for(n=1;n<b;n++)c[n]=E(c[n-1].concat(d)),a=a.concat(c[n]);b=a.slice(0,4*q);c=a.slice(4*q,4*q+16);return{key:b,iv:c}},M=function(a,d,b){d=G(d);var c=Math.ceil(a.length/16),n=[],m,p=[];for(m=0;m<c;m++){var k=m,l=a.slice(16*m,16*m+16),g=[];if(16>l.length){var e=16-l.length;g=[e,e,e,e,e,e,e,e,e,e,e,e,e,e,e,e]}for(e=0;e<l.length;e++)g[e]=l[e];n[k]=g}0===a.length%16&&n.push([16,16,16,16,16,16,16,16,16,
16,16,16,16,16,16,16]);for(m=0;m<n.length;m++)n[m]=0===m?w(n[m],b):w(n[m],p[m-1]),p[m]=L(n[m],d);return p},O=function(a,d,b,c){d=G(d);var n=a.length/16,m=[],p,k=[],l="";for(p=0;p<n;p++)m.push(a.slice(16*p,16*(p+1)));for(p=m.length-1;0<=p;p--)k[p]=N(m[p],d),k[p]=0===p?w(k[p],b):w(k[p],m[p-1]);for(p=0;p<n-1;p++)l+=K(k[p]);l+=K(k[p],!0);if(c)var g=l;else try{g=decodeURIComponent(escape(l))}catch(e){throw"Bad Key";}return g},L=function(a,d){t=!1;a=x(a,d,0);var b;for(b=1;b<r+1;b++)a=P(a),a=Q(a),b<r&&(a=
R(a)),a=x(a,d,b);return a},N=function(a,d){t=!0;a=x(a,d,r);var b;for(b=r-1;-1<b;b--)a=Q(a),a=P(a),a=x(a,d,b),0<b&&(a=R(a));return a},P=function(a){var d=t?T:H,b=[],c;for(c=0;16>c;c++)b[c]=d[a[c]];return b},Q=function(a){var d=[],b=t?[0,13,10,7,4,1,14,11,8,5,2,15,12,9,6,3]:[0,5,10,15,4,9,14,3,8,13,2,7,12,1,6,11],c;for(c=0;16>c;c++)d[c]=a[b[c]];return d},R=function(a){var d=[],b;if(t)for(b=0;4>b;b++)d[4*b]=y[a[4*b]]^z[a[1+4*b]]^A[a[2+4*b]]^B[a[3+4*b]],d[1+4*b]=B[a[4*b]]^y[a[1+4*b]]^z[a[2+4*b]]^A[a[3+
4*b]],d[2+4*b]=A[a[4*b]]^B[a[1+4*b]]^y[a[2+4*b]]^z[a[3+4*b]],d[3+4*b]=z[a[4*b]]^A[a[1+4*b]]^B[a[2+4*b]]^y[a[3+4*b]];else for(b=0;4>b;b++)d[4*b]=C[a[4*b]]^D[a[1+4*b]]^a[2+4*b]^a[3+4*b],d[1+4*b]=a[4*b]^C[a[1+4*b]]^D[a[2+4*b]]^a[3+4*b],d[2+4*b]=a[4*b]^a[1+4*b]^C[a[2+4*b]]^D[a[3+4*b]],d[3+4*b]=D[a[4*b]]^a[1+4*b]^a[2+4*b]^C[a[3+4*b]];return d},x=function(a,d,b){var c=[],n;for(n=0;16>n;n++)c[n]=a[n]^d[b][n];return c},w=function(a,d){var b=[],c;for(c=0;16>c;c++)b[c]=a[c]^d[c];return b},G=function(a){var d=
[],b=[],c,n=[];for(c=0;c<q;c++){var m=[a[4*c],a[4*c+1],a[4*c+2],a[4*c+3]];d[c]=m}for(c=q;c<4*(r+1);c++){d[c]=[];for(a=0;4>a;a++)b[a]=d[c-1][a];if(0===c%q){a=b;m=a[0];for(b=0;4>b;b++)a[b]=a[b+1];a[3]=m;b=S(a);b[0]^=U[c/q-1]}else 6<q&&4===c%q&&(b=S(b));for(a=0;4>a;a++)d[c][a]=d[c-q][a]^b[a]}for(c=0;c<r+1;c++)for(n[c]=[],b=0;4>b;b++)n[c].push(d[4*c+b][0],d[4*c+b][1],d[4*c+b][2],d[4*c+b][3]);return n},S=function(a){for(var d=0;4>d;d++)a[d]=H[a[d]];return a},I=function(a,d){var b,c=[];for(b=0;b<a.length;b+=
d)c[b/d]=parseInt(a.substr(b,d),16);return c},u=function(a){var d,b=[];for(d=0;256>d;d++){var c=d,n,m,p=a,k=d;for(m=n=0;8>m;m++)n=1===(k&1)?n^p:n,p=127<p?283^p<<1:p<<1,k>>>=1;b[c]=n}return b},H=I("637c777bf26b6fc53001672bfed7ab76ca82c97dfa5947f0add4a2af9ca472c0b7fd9326363ff7cc34a5e5f171d8311504c723c31896059a071280e2eb27b27509832c1a1b6e5aa0523bd6b329e32f8453d100ed20fcb15b6acbbe394a4c58cfd0efaafb434d338545f9027f503c9fa851a3408f929d38f5bcb6da2110fff3d2cd0c13ec5f974417c4a77e3d645d197360814fdc222a908846eeb814de5e0bdbe0323a0a4906245cc2d3ac629195e479e7c8376d8dd54ea96c56f4ea657aae08ba78252e1ca6b4c6e8dd741f4bbd8b8a703eb5664803f60e613557b986c11d9ee1f8981169d98e949b1e87e9ce5528df8ca1890dbfe6426841992d0fb054bb16",
2),T=function(a){var d,b=[];for(d=0;d<a.length;d++)b[a[d]]=d;return b}(H),U=I("01020408102040801b366cd8ab4d9a2f5ebc63c697356ad4b37dfaefc591",2),C=u(2),D=u(3),B=u(9),z=u(11),A=u(13),y=u(14),E=function(a){function d(a,b){var c=a&2147483648;var d=b&2147483648;var e=a&1073741824;var g=b&1073741824;a=(a&1073741823)+(b&1073741823);return e&g?a^2147483648^c^d:e|g?a&1073741824?a^3221225472^c^d:a^1073741824^c^d:a^c^d}function b(a,b,c,e,g,f,h){a=d(a,d(d(b&c|~b&e,g),h));return d(a<<f|a>>>32-f,b)}function c(a,
b,c,e,g,f,h){a=d(a,d(d(b&e|c&~e,g),h));return d(a<<f|a>>>32-f,b)}function n(a,b,c,e,g,f,h){a=d(a,d(d(b^c^e,g),h));return d(a<<f|a>>>32-f,b)}function m(a,b,c,e,g,f,h){a=d(a,d(d(c^(b|~e),g),h));return d(a<<f|a>>>32-f,b)}function p(a){var b,c=[];for(b=0;3>=b;b++){var d=a>>>8*b&255;c=c.concat(d)}return c}var k=[],l=I("67452301efcdab8998badcfe10325476d76aa478e8c7b756242070dbc1bdceeef57c0faf4787c62aa8304613fd469501698098d88b44f7afffff5bb1895cd7be6b901122fd987193a679438e49b40821f61e2562c040b340265e5a51e9b6c7aad62f105d02441453d8a1e681e7d3fbc821e1cde6c33707d6f4d50d87455a14eda9e3e905fcefa3f8676f02d98d2a4c8afffa39428771f6816d9d6122fde5380ca4beea444bdecfa9f6bb4b60bebfbc70289b7ec6eaa127fad4ef308504881d05d9d4d039e6db99e51fa27cf8c4ac5665f4292244432aff97ab9423a7fc93a039655b59c38f0ccc92ffeff47d85845dd16fa87e4ffe2ce6e0a30143144e0811a1f7537e82bd3af2352ad7d2bbeb86d391",
8);k=function(a){var b=a.length;var c=b+8;for(var d=16*((c-c%64)/64+1),e=[],g,f=0;f<b;)c=(f-f%4)/4,g=f%4*8,e[c]|=a[f]<<g,f++;c=(f-f%4)/4;e[c]|=128<<f%4*8;e[d-2]=b<<3;e[d-1]=b>>>29;return e}(a);var g=l[0];var e=l[1];var f=l[2];var h=l[3];for(a=0;a<k.length;a+=16){var q=g;var r=e;var t=f;var u=h;g=b(g,e,f,h,k[a+0],7,l[4]);h=b(h,g,e,f,k[a+1],12,l[5]);f=b(f,h,g,e,k[a+2],17,l[6]);e=b(e,f,h,g,k[a+3],22,l[7]);g=b(g,e,f,h,k[a+4],7,l[8]);h=b(h,g,e,f,k[a+5],12,l[9]);f=b(f,h,g,e,k[a+6],17,l[10]);e=b(e,f,h,g,
k[a+7],22,l[11]);g=b(g,e,f,h,k[a+8],7,l[12]);h=b(h,g,e,f,k[a+9],12,l[13]);f=b(f,h,g,e,k[a+10],17,l[14]);e=b(e,f,h,g,k[a+11],22,l[15]);g=b(g,e,f,h,k[a+12],7,l[16]);h=b(h,g,e,f,k[a+13],12,l[17]);f=b(f,h,g,e,k[a+14],17,l[18]);e=b(e,f,h,g,k[a+15],22,l[19]);g=c(g,e,f,h,k[a+1],5,l[20]);h=c(h,g,e,f,k[a+6],9,l[21]);f=c(f,h,g,e,k[a+11],14,l[22]);e=c(e,f,h,g,k[a+0],20,l[23]);g=c(g,e,f,h,k[a+5],5,l[24]);h=c(h,g,e,f,k[a+10],9,l[25]);f=c(f,h,g,e,k[a+15],14,l[26]);e=c(e,f,h,g,k[a+4],20,l[27]);g=c(g,e,f,h,k[a+9],
5,l[28]);h=c(h,g,e,f,k[a+14],9,l[29]);f=c(f,h,g,e,k[a+3],14,l[30]);e=c(e,f,h,g,k[a+8],20,l[31]);g=c(g,e,f,h,k[a+13],5,l[32]);h=c(h,g,e,f,k[a+2],9,l[33]);f=c(f,h,g,e,k[a+7],14,l[34]);e=c(e,f,h,g,k[a+12],20,l[35]);g=n(g,e,f,h,k[a+5],4,l[36]);h=n(h,g,e,f,k[a+8],11,l[37]);f=n(f,h,g,e,k[a+11],16,l[38]);e=n(e,f,h,g,k[a+14],23,l[39]);g=n(g,e,f,h,k[a+1],4,l[40]);h=n(h,g,e,f,k[a+4],11,l[41]);f=n(f,h,g,e,k[a+7],16,l[42]);e=n(e,f,h,g,k[a+10],23,l[43]);g=n(g,e,f,h,k[a+13],4,l[44]);h=n(h,g,e,f,k[a+0],11,l[45]);
f=n(f,h,g,e,k[a+3],16,l[46]);e=n(e,f,h,g,k[a+6],23,l[47]);g=n(g,e,f,h,k[a+9],4,l[48]);h=n(h,g,e,f,k[a+12],11,l[49]);f=n(f,h,g,e,k[a+15],16,l[50]);e=n(e,f,h,g,k[a+2],23,l[51]);g=m(g,e,f,h,k[a+0],6,l[52]);h=m(h,g,e,f,k[a+7],10,l[53]);f=m(f,h,g,e,k[a+14],15,l[54]);e=m(e,f,h,g,k[a+5],21,l[55]);g=m(g,e,f,h,k[a+12],6,l[56]);h=m(h,g,e,f,k[a+3],10,l[57]);f=m(f,h,g,e,k[a+10],15,l[58]);e=m(e,f,h,g,k[a+1],21,l[59]);g=m(g,e,f,h,k[a+8],6,l[60]);h=m(h,g,e,f,k[a+15],10,l[61]);f=m(f,h,g,e,k[a+6],15,l[62]);e=m(e,
f,h,g,k[a+13],21,l[63]);g=m(g,e,f,h,k[a+4],6,l[64]);h=m(h,g,e,f,k[a+11],10,l[65]);f=m(f,h,g,e,k[a+2],15,l[66]);e=m(e,f,h,g,k[a+9],21,l[67]);g=d(g,q);e=d(e,r);f=d(f,t);h=d(h,u)}return p(g).concat(p(e),p(f),p(h))},J=function(){var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",d=a.split("");"function"===typeof Array.indexOf&&(a=d);return{encode:function(a,c){var b=[];c="";var m;for(m=0;m<16*a.length;m++)b.push(a[Math.floor(m/16)][m%16]);for(m=0;m<b.length;m+=3)c+=d[b[m]>>2],c+=
d[(b[m]&3)<<4|b[m+1]>>4],c=void 0!==b[m+1]?c+d[(b[m+1]&15)<<2|b[m+2]>>6]:c+"=",c=void 0!==b[m+2]?c+d[b[m+2]&63]:c+"=";a=c.slice(0,64)+"\n";for(m=1;m<Math.ceil(c.length/64);m++)a+=c.slice(64*m,64*m+64)+(Math.ceil(c.length/64)===m+1?"":"\n");return a},decode:function(b){b=b.replace(/\n/g,"");var c=[],d=[],m=[],p;for(p=0;p<b.length;p+=4)d[0]=a.indexOf(b.charAt(p)),d[1]=a.indexOf(b.charAt(p+1)),d[2]=a.indexOf(b.charAt(p+2)),d[3]=a.indexOf(b.charAt(p+3)),m[0]=d[0]<<2|d[1]>>4,m[1]=(d[1]&15)<<4|d[2]>>2,
m[2]=(d[2]&3)<<6|d[3],c.push(m[0],m[1],m[2]);return c=c.slice(0,c.length-c.length%16)}}}();return{size:function(a){switch(a){case 128:r=10;q=4;break;case 192:r=12;q=6;break;case 256:r=14;q=8;break;default:throw"Invalid Key Size Specified:"+a;}},h2a:function(a){var d=[];a.replace(/(..)/g,function(a){d.push(parseInt(a,16))});return d},expandKey:G,encryptBlock:L,decryptBlock:N,Decrypt:t,s2a:v,rawEncrypt:M,rawDecrypt:O,dec:function(a,d,b){a=J.decode(a);var c=a.slice(8,16);c=F(v(d,b),c);d=c.key;c=c.iv;
a=a.slice(16,a.length);return a=O(a,d,c,b)},openSSLKey:F,a2h:function(a){var d="",b;for(b=0;b<a.length;b++)d+=(16>a[b]?"0":"")+a[b].toString(16);return d},enc:function(a,d,b){var c=[];var n;for(n=0;8>n;n++)c=c.concat(Math.floor(256*Math.random()));n=F(v(d,b),c);d=n.key;n=n.iv;c=[[83,97,108,116,101,100,95,95].concat(c)];a=v(a,b);a=M(a,d,n);a=c.concat(a);return J.encode(a)},Hash:{MD5:E},Base64:J}});
